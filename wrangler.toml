# 核心配置：匹配 CI 期望的 Worker 名称，解决之前的名称不匹配警告
name = "stockweb"
# 必填：兼容性日期（与你之前的配置一致，无需修改）
compatibility_date = "2025-11-24"
# 兼容 Node.js 特性（若前端依赖 Node.js 相关 API，保留；否则可删除）
compatibility_flags = ["nodejs_compat"]

# 关键修正：指定部署类型为静态资源（而非动态 Worker 脚本）
type = "static"

# 静态资源构建配置（关联 Vite 构建流程）
[
build
]
# 部署前执行的构建命令（与 package.json 中的 build 脚本一致）
command = "npm run build"
# Vite 构建产物目录（必须指向 dist，否则无法找到静态文件）
dist = "dist"
# 实际发布的目录（与 dist 一致，确保静态资源被正确上传）
publish = "dist"

# 环境变量（前端可通过 import.meta.env 访问，如后端 API 地址）
[
vars
]
NODE_ENV = "production"
# 可选：添加前端需要的环境变量（如后端 .NET 服务地址，需与 .env.production 一致）
VITE_API_URL = "https://apistock-1hgl.onrender.com"  # 替换为你的后端生产地址
VITE_Web_Trader_UUID='7c5b1305-c996-4e22-8096-ab8444004a8f'

# 可选：静态资源缓存优化（提升访问速度）
[
build.upload
]
# 静态资源缓存策略：文件变更时绕过缓存，否则缓存 1 小时
cache_control = { bypass_cache_on_changes = true, max_age = 3600 }
# 压缩静态资源（减少传输体积）
compression = "gzip"